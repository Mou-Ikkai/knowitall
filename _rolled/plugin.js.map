{"version":3,"file":"plugin.js","sources":["../src/plugin.js"],"sourcesContent":["/*\n *  File: plugin.js\n *  Author: Aspen\n *  Copyright (C) 2020 aspen\n *\n *  This software is provided 'as-is', without any express or implied warranty. In\n *  no event will the authors be held liable for any damages arising from the use of\n *  this software.\n *\n *  Permission is granted to anyone to use this software for any purpose, including\n *  commercial applications, and to alter it and redistribute it freely, subject to\n *  the following restrictions:\n *\n *  1.  The origin of this software must not be misrepresented; you must not claim\n *      that you wrote the original software. If you use this software in a product,\n *      an acknowledgment in the product documentation would be appreciated but is\n *      not required.\n *\n *  2.  Altered source versions must be plainly marked as such, and must not be\n *      misrepresented as being the original software.\n *\n *  3.  This notice may not be removed or altered from any source distribution.\n *\n */\n\nconst { Plugin } = require('powercord/entities');\nconst { inject, uninject } = require('powercord/injector');\nconst {\n\tReact,\n\tFlux,\n\tgetModule,\n\tgetModuleByDisplayName,\n\ti18n: { Messages },\n} = require('powercord/webpack');\n\nexport default class KnowItAll extends Plugin {\n\tasync startPlugin() {\n\t\tawait this.load_wasm_provider();\n\t\tawait this.import_functions();\n\t\tawait this.inject_hooks();\n\t}\n\n\tasync load_wasm_provider() {\n\t\tthis.wasm = await import('../provider/Cargo.toml');\n\t\tthis.Provider = await this.wasm.default();\n\t}\n\n\tasync import_functions() {\n\t\tthis.get_member = await getModule(['getMember']);\n\t\tthis.get_channel = await getModule(['getChannel']);\n\t}\n\n\tasync inject_hooks() {\n\t\tconst ChannelMessage = (await getModule(['MESSAGE_ID_PREFIX'])).default;\n\t\tconst oType = ChannelMessage.type;\n\t\tinject(\n\t\t\t'knowitall_ChannelMessage',\n\t\t\tChannelMessage,\n\t\t\t'type',\n\t\t\t(args, res) => {\n\t\t\t\ttry {\n\t\t\t\t\tif (\n\t\t\t\t\t\ttypeof res?.props?.childrenMessageContent?.props\n\t\t\t\t\t\t\t?.content === 'object'\n\t\t\t\t\t) {\n\t\t\t\t\t\tres.props.childrenMessageContent.props.content = this.handle_message_content(\n\t\t\t\t\t\t\tres.props.childrenMessageContent.props.content\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tthis.error(e);\n\t\t\t\t}\n\t\t\t\treturn args, res;\n\t\t\t}\n\t\t);\n\t}\n\n\tasync import(filter, functionName = filter) {\n\t\tif (typeof filter === 'string') {\n\t\t\tfilter = [filter];\n\t\t}\n\n\t\treturn (await getModule(filter))[functionName];\n\t}\n\n\thandle_message_content(content) {\n\t\ttry {\n\t\t\tif (typeof content === 'string') {\n\t\t\t\tcontent = [content];\n\t\t\t} else if (typeof content === 'function') {\n\t\t\t\t// da fuck?\n\t\t\t\treturn content;\n\t\t\t}\n\t\t\treturn content.map((element) => {\n\t\t\t\tif (\n\t\t\t\t\ttypeof element === 'object' &&\n\t\t\t\t\telement?.props?.children?.length > 0\n\t\t\t\t) {\n\t\t\t\t\telement.props.children = this.handle_message_content(\n\t\t\t\t\t\telement.props.children\n\t\t\t\t\t);\n\t\t\t\t\treturn element;\n\t\t\t\t} else if (typeof element === 'string') {\n\t\t\t\t\tlet x = this.Provider.parse_message(element);\n\t\t\t\t\tif (x && x.length > 0) {\n\t\t\t\t\t}\n\t\t\t\t\treturn element;\n\t\t\t\t} else {\n\t\t\t\t\treturn element;\n\t\t\t\t}\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tthis.error(e);\n\t\t}\n\t\treturn content;\n\t}\n\n\tpluginWillUnload() {\n\t\tuninject('knowitall_ChannelMessage');\n\t}\n}\n"],"names":[],"mappings":"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"}